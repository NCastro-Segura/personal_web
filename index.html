<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dr. Noel Castro Segura - Astrophysicist specializing in compact objects and time domain astronomy at the University of Warwick">
    <meta name="keywords" content="astrophysics, compact objects, neutron stars, time domain astronomy, accretion">
    <meta name="author" content="Dr. Noel Castro Segura">
    <title>Dr. Noel Castro Segura - Astrophysicist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #2d2d5f 100%);
            color: white;
            overflow-x: hidden;
            height: 100vh;
        }
        
        .constellation-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .dot {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }
        
        .line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform-origin: left center;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        .header {
            background: rgba(12, 12, 30, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            padding: 1rem 2rem;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
        }
        
        .tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab.active {
            color: #64b5f6;
            border-bottom-color: #64b5f6;
            background: rgba(100, 181, 246, 0.1);
        }
        
        .content-area {
            height: calc(100vh - 200px);
            overflow-y: auto;
            padding: 2rem;
        }
        
        .tab-content {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .home-content {
            text-align: center;
            padding: 3rem 0;
        }
        
        .home-content h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #64b5f6, #90caf9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .home-content p {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #64b5f6;
        }
        
        .about-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 3rem;
            align-items: start;
            padding: 2rem 0;
        }
        
        .profile-placeholder {
            width: 250px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #64b5f6;
            margin: 0 auto;
        }
        
        .about-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .about-text p {
            margin-bottom: 1.5rem;
        }
        
        .research-content {
            padding: 2rem 0;
        }
        
        .featured-articles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }
        
        .article-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, border-color 0.3s;
        }
        
        .article-card:hover {
            transform: translateY(-5px);
            border-color: #64b5f6;
        }
        
        .article-card h3 {
            color: #64b5f6;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .article-card p {
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .article-link {
            color: #64b5f6;
            text-decoration: none;
            font-weight: bold;
        }
        
        .article-link:hover {
            text-decoration: underline;
        }
        
        .publications-content {
            padding: 2rem 0;
        }
        
        .loading-state {
            animation: pulse 2s infinite;
            text-align: center;
            padding: 2rem;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .contact-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 0;
        }
        
        .contact-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 3rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #64b5f6;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #64b5f6;
        }
        
        .btn {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            font-size: 1rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .global-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1rem 2rem;
            background: rgba(12, 12, 30, 0.8);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(100, 181, 246, 0.2);
            z-index: 1000;
            flex-wrap: wrap;
        }
        
        .footer-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 25px;
            color: #64b5f6;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .footer-link:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: #64b5f6;
            transform: translateY(-2px);
        }
        
        .footer-link svg {
            width: 18px;
            height: 18px;
        }
        
        .section-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #64b5f6;
        }
        
        #pagination-controls {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem 0;
        }
        
        .pagination-info {
            opacity: 0.8;
            margin-bottom: 1rem;
        }
        
        .pagination-buttons {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .page-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            font-size: 0.9rem;
        }
        
        .page-btn:hover:not(.active) {
            transform: translateY(-2px);
        }
        
        .page-btn.active {
            background: #42a5f5;
            cursor: default;
        }
        
        .page-ellipsis {
            padding: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        @media (max-width: 768px) {
            .about-content {
                grid-template-columns: 1fr;
            }
            
            .home-content h1 {
                font-size: 2rem;
            }
            
            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .featured-articles {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="constellation-bg" id="constellation"></div>
    
    <header class="header">
        <div class="header-content">
            <div class="logo">Dr. Noel Castro Segura - Astrophysicist</div>
            <nav class="tabs">
                <button class="tab active" data-tab="home">Home</button>
                <button class="tab" data-tab="about">About</button>
                <button class="tab" data-tab="research">Research</button>
                <button class="tab" data-tab="publications">Publications</button>
                <button class="tab" data-tab="contact">Contact</button>
            </nav>
        </div>
    </header>
    
    <div class="global-footer">
        <a href="https://orcid.org/0000-0002-5870-0443" class="footer-link" title="ORCID Profile" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zM7.369 4.378c.525 0 .947.431.947.947 0 .525-.422.947-.947.947-.525 0-.946-.422-.946-.947 0-.516.421-.947.946-.947zm-.722 3.038h1.444v10.041H6.647V7.416zm3.562 0h3.9c3.712 0 5.344 2.653 5.344 5.025 0 2.578-2.016 5.016-5.325 5.016h-3.919V7.416zm1.444 1.303v7.444h2.297c2.359 0 3.588-1.444 3.588-3.722 0-2.016-1.091-3.722-3.847-3.722h-2.038z"/>
            </svg>
            ORCID
        </a>
        <a href="https://github.com/NCastro-Segura" class="footer-link" title="GitHub Profile" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            GitHub
        </a>
        <a href="cv.pdf" class="footer-link" title="Download CV" target="_blank">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            Download CV
        </a>
    </div>
    
    <main class="content-area">
        <div id="home" class="tab-content active">
            <div class="home-content">
                <h1>Dr. Noel Castro Segura</h1>
                <p>Astrophysicist & Research Fellow</p>
                <p>University of Warwick</p>
                <p>Specialist in compact objects, time domain astronomy, and accretion physics</p>
            </div>
        </div>
        
        <div id="about" class="tab-content">
            <h2 class="section-title">About Me</h2>
            <div class="about-content">
                <div>
                    <div class="profile-placeholder">
                        <span>Profile Photo</span>
                    </div>
                </div>
                <div class="about-text">
                    <p>I am an astrophysicist specializing in compact objects and time domain astronomy at the University of Warwick. My research focuses on understanding the fundamental processes of accretion and outflows in neutron stars and black holes.</p>
                    
                    <p>My work combines multi-wavelength observational astronomy with theoretical modeling to explore some of the most extreme environments in the universe. I am particularly interested in how matter behaves under the extreme gravitational fields of compact objects.</p>
                    
                    <p>Current research interests include X-ray binary systems, accretion disc winds, neutron star binaries, and the development of high-speed optical instrumentation for time-resolved astronomy. I am actively involved in the development of OPTICAM, a triple-camera optical system designed to explore the fastest timescales in astronomy.</p>
                    
                    <p>I contribute to international collaborations and use data from space-based missions as well as ground-based telescopes to study the rapid variability and outflow phenomena in accreting compact objects.</p>
                </div>
            </div>
        </div>
        
        <div id="research" class="tab-content">
            <h2 class="section-title">Research & Publications</h2>
            
            <div class="stats" style="margin-bottom: 3rem;">
                <div class="stat-item">
                    <div class="stat-number" id="pub-count">0</div>
                    <div>Total Publications</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="citation-count">0</div>
                    <div>Citations</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="h-index">0</div>
                    <div>h-index</div>
                </div>
            </div>
            
            <div class="research-content">
                <div id="publications-loading" class="loading-state">
                    <div style="color: #64b5f6; font-size: 1.2rem;">Loading publications from ADS...</div>
                    <div style="opacity: 0.7; margin-top: 0.5rem;">Fetching data using ORCID: 0000-0002-5870-0443</div>
                </div>
                
                <div id="publications-container" class="featured-articles" style="display: none;"></div>
                
                <div id="pagination-controls"></div>
                
                <div style="text-align: center; margin-top: 3rem;">
                    <p style="opacity: 0.8; margin-bottom: 1rem;">Publications automatically retrieved from ADS</p>
                    <a href="https://ui.adsabs.harvard.edu/search/q=orcid%3A0000-0002-5870-0443%20OR%20author:%22Castro-Segura%22" class="btn" target="_blank" style="display: inline-block; text-decoration: none;">View Complete List on ADS</a>
                </div>
            </div>
        </div>
        
        <div id="publications" class="tab-content">
            <h2 class="section-title">All Publications</h2>
            <div class="publications-content" style="text-align: center;">
                <p style="opacity: 0.8; margin-bottom: 2rem;">For a complete and up-to-date list of all publications, please visit:</p>
                <a href="https://ui.adsabs.harvard.edu/search/q=orcid%3A0000-0002-5870-0443%20OR%20author:%22Castro-Segura%22" class="btn" target="_blank" style="display: inline-block; text-decoration: none; margin-bottom: 2rem;">View All Publications on ADS</a>
                <br>
                <a href="https://orcid.org/0000-0002-5870-0443" class="btn" target="_blank" style="display: inline-block; text-decoration: none;">View ORCID Profile</a>
            </div>
        </div>
        
        <div id="contact" class="tab-content">
            <h2 class="section-title">Contact Me</h2>
            <div class="contact-content">
                <form class="contact-form" id="contactForm">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <input type="text" id="subject" name="subject" required>
                    </div>
                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="6" required placeholder="Your message here..."></textarea>
                    </div>
                    <button type="submit" class="btn">Send Message</button>
                </form>
            </div>
        </div>
    </main>
    
    <script>
        // Constellation background with fixed line alignment
        function createConstellation() {
            const constellation = document.getElementById('constellation');
            const numDots = 40;
            const dots = [];
            
            // Get actual container dimensions in pixels
            function getContainerDimensions() {
                return {
                    width: constellation.offsetWidth,
                    height: constellation.offsetHeight
                };
            }
            
            // Create dots
            for (let i = 0; i < numDots; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                dot.style.left = x + '%';
                dot.style.top = y + '%';
                dot.style.animationDelay = Math.random() * 3 + 's';
                constellation.appendChild(dot);
                
                dots.push({
                    element: dot,
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 0.02,
                    vy: (Math.random() - 0.5) * 0.02
                });
            }
            
            function animate() {
                // Remove old lines
                const existingLines = constellation.querySelectorAll('.line');
                existingLines.forEach(line => line.remove());
                
                // Get current dimensions
                const dims = getContainerDimensions();
                
                // Update dot positions
                dots.forEach(dot => {
                    dot.x += dot.vx;
                    dot.y += dot.vy;
                    
                    // Bounce off edges
                    if (dot.x <= 0 || dot.x >= 100) dot.vx *= -1;
                    if (dot.y <= 0 || dot.y >= 100) dot.vy *= -1;
                    
                    // Keep within bounds
                    dot.x = Math.max(0, Math.min(100, dot.x));
                    dot.y = Math.max(0, Math.min(100, dot.y));
                    
                    // Update position
                    dot.element.style.left = dot.x + '%';
                    dot.element.style.top = dot.y + '%';
                });
                
                // Draw lines between nearby dots
                for (let i = 0; i < dots.length; i++) {
                    for (let j = i + 1; j < dots.length; j++) {
                        // Calculate distance in percentage units
                        const dx = dots[j].x - dots[i].x;
                        const dy = dots[j].y - dots[i].y;
                        
                        // Convert to actual pixel distance
                        const pixelDx = (dx / 100) * dims.width;
                        const pixelDy = (dy / 100) * dims.height;
                        const pixelDistance = Math.sqrt(pixelDx * pixelDx + pixelDy * pixelDy);
                        
                        // Connection threshold based on screen size (15% of smaller dimension)
                        const connectionThreshold = Math.min(dims.width, dims.height) * 0.15;
                        
                        if (pixelDistance < connectionThreshold) {
                            const line = document.createElement('div');
                            line.className = 'line';
                            
                            // Calculate angle for rotation
                            const angle = Math.atan2(dy, dx);
                            
                            // Use PIXELS for line width (this fixes the alignment issue)
                            line.style.width = pixelDistance + 'px';
                            line.style.left = dots[i].x + '%';
                            line.style.top = dots[i].y + '%';
                            line.style.transform = `rotate(${angle}rad)`;
                            line.style.opacity = (1 - pixelDistance / connectionThreshold) * 0.6;
                            
                            constellation.appendChild(line);
                        }
                    }
                }
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Animation loop already handles dimension updates
                }, 250);
            });
        }
        
        createConstellation();
        
        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
            });
        });
        
        // Publications with pagination
        let currentPage = 1;
        const pageSize = 10;
        let totalStats = { totalPublications: 0, totalCitations: 0, hIndex: 0 };

        async function fetchPublications(page = 1) {
            try {
                const isNetlify = window.location.hostname.includes('netlify.app') || window.location.hostname.includes('netlify.com');
                const apiUrl = isNetlify 
                    ? `/.netlify/functions/fetch-publications?page=${page}&pageSize=${pageSize}`
                    : null;

                if (apiUrl) {
                    document.getElementById('publications-loading').style.display = 'block';
                    document.getElementById('publications-container').style.display = 'none';
                    
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        currentPage = page;
                        
                        document.getElementById('pub-count').textContent = data.stats.totalPublications;
                        
                        if (page === 1) {
                            await fetchAllStats();
                        }
                        
                        displayPublications(data.publications);
                        
                        // Check if pagination data exists before calling displayPagination
                        if (data.pagination) {
                            displayPagination(data.pagination);
                        }
                    } else {
                        throw new Error(data.message || 'Failed to fetch publications');
                    }
                } else {
                    console.log('Using mock data - deploy to Netlify for live ADS integration');
                    setTimeout(() => {
                        const mockPublications = [
                            {
                                title: "A persistent ultraviolet outflow from an accreting neutron star binary transient",
                                authors: ["Castro Segura, N.", "Knigge, C.", "Long, K. S.", "et al."],
                                journal: "Nature",
                                year: "2022",
                                bibcode: "2022Natur.603...52C",
                                citations: 15,
                                abstract: "We report the discovery of persistent UV outflows..."
                            },
                            {
                                title: "OPTICAM: A triple-camera optical system designed to explore the fastest timescales in Astronomy",
                                authors: ["Castro Segura, N.", "Knigge, C.", "Acosta-Pulido, J. A.", "et al."],
                                journal: "Monthly Notices of the Royal Astronomical Society",
                                year: "2019",
                                bibcode: "2019MNRAS.490.1035C",
                                citations: 8,
                                abstract: "We present OPTICAM, a high-time resolution..."
                            }
                        ];
                        
                        displayPublications(mockPublications);
                        
                        // Create mock pagination data
                        const mockPagination = {
                            currentPage: 1,
                            totalPages: 1,
                            totalResults: 2,
                            hasNextPage: false,
                            hasPreviousPage: false,
                            pageSize: 10
                        };
                        
                        displayPagination(mockPagination);
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Error fetching publications:', error);
                showError();
            }
        }

        async function fetchAllStats() {
            try {
                const response = await fetch(`/.netlify/functions/fetch-publications?page=1&pageSize=1000`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const allCitations = data.publications.map(p => p.citations || 0);
                        const totalCitations = allCitations.reduce((sum, c) => sum + c, 0);
                        const hIndex = calculateHIndex(allCitations);
                        
                        totalStats = {
                            totalPublications: data.stats.totalPublications,
                            totalCitations: totalCitations,
                            hIndex: hIndex
                        };
                        
                        document.getElementById('citation-count').textContent = totalCitations;
                        document.getElementById('h-index').textContent = hIndex;
                    }
                }
            } catch (error) {
                console.error('Error fetching statistics:', error);
            }
        }

        function calculateHIndex(citations) {
            if (!citations || citations.length === 0) return 0;
            const sorted = [...citations].sort((a, b) => b - a);
            let hIndex = 0;
            for (let i = 0; i < sorted.length; i++) {
                if (sorted[i] >= i + 1) {
                    hIndex = i + 1;
                } else {
                    break;
                }
            }
            return hIndex;
        }

        function displayPublications(publications) {
            const container = document.getElementById('publications-container');
            const loading = document.getElementById('publications-loading');
            
            loading.style.display = 'none';
            container.innerHTML = '';
            
            if (!window.location.hostname.includes('netlify.app') && !window.location.hostname.includes('netlify.com')) {
                const totalCitations = publications.reduce((sum, pub) => sum + (pub.citations || 0), 0);
                document.getElementById('pub-count').textContent = publications.length + '+';
                document.getElementById('citation-count').textContent = totalCitations + '+';
            }
            
            publications.forEach(pub => {
                const pubElement = document.createElement('article');
                pubElement.className = 'article-card';
                
                let authorString = pub.authors.slice(0, 5).join(', ');
                if (pub.authors.length > 5) {
                    authorString += ', et al.';
                }
                
                const doiLink = pub.doi ? `<br><a href="https://doi.org/${pub.doi}" class="article-link" target="_blank" style="font-size: 0.85rem;">DOI: ${pub.doi}</a>` : '';
                
                pubElement.innerHTML = `
                    <h3>${pub.title}</h3>
                    <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">${authorString}</p>
                    <p><strong>Published in:</strong> ${pub.journal}, ${pub.year}</p>
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Citations: ${pub.citations || 0}</p>
                    ${pub.abstract ? `<p style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-top: 0.5rem;">${pub.abstract.substring(0, 200)}...</p>` : ''}
                    <a href="https://ui.adsabs.harvard.edu/abs/${pub.bibcode}" class="article-link" target="_blank">View on ADS →</a>
                    ${doiLink}
                `;
                container.appendChild(pubElement);
            });
            
            container.style.display = 'grid';
        }

        function displayPagination(pagination) {
            const paginationContainer = document.getElementById('pagination-controls');
            
            // Safety check - if pagination is undefined or invalid, don't display
            if (!pagination || !pagination.currentPage || !pagination.totalPages) {
                console.warn('Invalid pagination data:', pagination);
                paginationContainer.innerHTML = '';
                return;
            }
            
            paginationContainer.innerHTML = '';
            
            const paginationInfo = document.createElement('p');
            paginationInfo.className = 'pagination-info';
            paginationInfo.textContent = `Page ${pagination.currentPage} of ${pagination.totalPages} (${pagination.totalResults} total publications)`;
            paginationContainer.appendChild(paginationInfo);
            
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'pagination-buttons';
            
            if (pagination.hasPreviousPage) {
                const prevBtn = createPageButton('← Previous', pagination.currentPage - 1);
                buttonContainer.appendChild(prevBtn);
            }
            
            const startPage = Math.max(1, pagination.currentPage - 2);
            const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
            
            if (startPage > 1) {
                buttonContainer.appendChild(createPageButton('1', 1));
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-ellipsis';
                    ellipsis.textContent = '...';
                    buttonContainer.appendChild(ellipsis);
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPageButton(i.toString(), i, i === pagination.currentPage);
                buttonContainer.appendChild(pageBtn);
            }
            
            if (endPage < pagination.totalPages) {
                if (endPage < pagination.totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-ellipsis';
                    ellipsis.textContent = '...';
                    buttonContainer.appendChild(ellipsis);
                }
                buttonContainer.appendChild(createPageButton(pagination.totalPages.toString(), pagination.totalPages));
            }
            
            if (pagination.hasNextPage) {
                const nextBtn = createPageButton('Next →', pagination.currentPage + 1);
                buttonContainer.appendChild(nextBtn);
            }
            
            paginationContainer.appendChild(buttonContainer);
        }

        function createPageButton(label, pageNumber, isActive = false) {
            const button = document.createElement('button');
            button.textContent = label;
            button.className = 'page-btn' + (isActive ? ' active' : '');
            
            if (!isActive) {
                button.onclick = () => {
                    fetchPublications(pageNumber);
                    document.getElementById('research').scrollIntoView({ behavior: 'smooth', block: 'start' });
                };
            }
            
            return button;
        }

        function showError() {
            const loading = document.getElementById('publications-loading');
            loading.innerHTML = `
                <div style="color: #ff6b6b;">Unable to load publications automatically</div>
                <div style="opacity: 0.7; margin-top: 0.5rem;">Please visit ADS directly to view publications</div>
                <div style="margin-top: 1rem;">
                    <a href="https://ui.adsabs.harvard.edu/search/q=orcid%3A0000-0002-5870-0443%20OR%20author:%22Castro-Segura%22" 
                       class="btn" target="_blank" style="display: inline-block; text-decoration: none;">
                        View on ADS
                    </a>
                </div>
            `;
        }

        let publicationsLoaded = false;
        document.querySelector('[data-tab="research"]').addEventListener('click', function() {
            if (!publicationsLoaded) {
                fetchPublications(1);
                publicationsLoaded = true;
            }
        });
        
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Form submitted! Note: To enable email functionality, you need to set up a backend service or use a service like Formspree, EmailJS, or Netlify Forms.');
        });
    </script>
</body>
</html>